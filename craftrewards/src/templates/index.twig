{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Craft Rewards plugin for Craft CMS 3.x
 *
 * Craft Rewards index.twig
 *
 * @author    ron.agapito
 * @copyright Copyright (c) 2020 ron.agapito
 * @link      ron.agapito@icloud.com
 * @package   CraftRewards
 * @since     1
 */
#}

{% extends "_layouts/cp" %}
{% import "_includes/forms" as forms %}

{% do view.registerAssetBundle("ron\\craftrewards\\assetbundles\\craftrewards\\CraftRewardsAsset") %}
{% do view.registerAssetBundle("ron\\craftrewards\\assetbundles\\indexcpsection\\IndexCPSectionAsset") %}

{% set docsUrl = "???" %}

{% set title = "Craft Rewards" %}

{% set pluginCpUrl = url('craft-rewards') %}

{% set iconUrl = view.getAssetManager().getPublishedUrl('@ron/craftrewards/assetbundles/indexcpsection/dist', true) ~ '/img/Index-icon.svg' %}

{% set extraPageHeaderHtml %}
    <div class="buttons">
        <a href="{{ pluginCpUrl }}" class="btn submit add icon">{{ "Click Me!"|t('craft-rewards') }}</a>
    </div>
{% endset %}

{% set content %}
  <div class="tableview tablepane">
    <table class="data fullwidth">
      <thead>

      <tr>
        <td>
          First Name
        </td>
        <td>
          Last Name
        </td>
        <td>
          Email
        </td>
        <td>
          Available Points
        </td>
        <td>
          Redeemed Points
        </td>
        <td>
          Expired Points
        </td>
        <td></td>
      </tr>
      </thead>

      {% for user in craft.craftRewards.getAllPoints %}
      <tr>
        <td>
          {{user.firstName}}
        </td>
        <td>
          {{user.lastName}}
        </td>
        <td>
          {{user.email}}
        </td>
        <td>
          {{user.points ? user.points : 0}}
        </td>

        <td>
          {{user.points_redeemed}}
        </td>

        <td>
          {{user.points_expired}}
        </td>
        <td>
          <button type="button" data-action="add" data-points="{{user.points}}" data-id="{{user.id}}" class="btn btn-success btnPoints" data-toggle="modal" data-target="#myModal">Add Points</button>
          <button type="button" data-action="remove" data-points="{{user.points}}" data-id="{{user.id}}" class="btn btn-danger btnPoints" data-toggle="modal" data-target="#myModal">Remove Points</button>

          
        </td>
      </tr>
      {% endfor %}
    </table>
    
    </div>
    
<!-- The Modal -->
<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Adjust Points</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <form action="" method="POST">
          {{ csrfInput() }}
          <input type="hidden" name="action" value="craft-rewards/default/add-points">
          <input type="hidden" name="customerId" id="customerId" value="">
          <input type="hidden" name="type" id="type" value="">




          <div class="form-group">
            <label>Current Points           <span class="badge badge-success pointsOnModal"></span>

          </div>
          <div class="form-group">
  </label>

      <label for="pwd" >Points</label>
      <input type="number" class="form-control"  name="points" id="points" onkeyup="this.value=this.value.replace(/[^\d]/,'')">
    </div>
    <div class="form-group">
      <button type="submit" class="btn btn-success" >Save</button>

    </div>
        </form>
    
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>



<style>
.modal{
  background: rgba(0,0,0,.3);
}
</style>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

<script>
$(".btnPoints").click(function()
{
  var p = $(this).data("points");
  var id = $(this).data("id");
  var action = $(this).data("action");
  $(".pointsOnModal").html(p);
  $("#type").val( action);
  $("#customerId").val(id);  
  $("#points").val(0)
});
</script>
{% endset %}
